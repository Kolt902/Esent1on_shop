# Руководство по деплою на Railway

Это руководство описывает процесс переноса приложения Esention на платформу Railway, сохраняя возможность продолжать разработку в Replit.

## Содержание

1. [Предварительные требования](#предварительные-требования)
2. [Экспорт базы данных](#экспорт-базы-данных)
3. [Настройка проекта в Railway](#настройка-проекта-в-railway)
4. [Деплой приложения](#деплой-приложения)
5. [Настройка переменных окружения](#настройка-переменных-окружения)
6. [Импорт базы данных](#импорт-базы-данных)
7. [Настройка Telegram бота](#настройка-telegram-бота)
8. [Проверка работоспособности](#проверка-работоспособности)
9. [Дальнейшая разработка](#дальнейшая-разработка)

## Предварительные требования

1. Аккаунт на [Railway](https://railway.app/)
2. Git репозиторий с проектом (или его форк)
3. Установленный Node.js и npm на локальном компьютере (если вы планируете запускать экспорт/импорт базы данных локально)

## Экспорт базы данных

Сначала необходимо создать резервную копию текущей базы данных из Replit:

1. Убедитесь, что переменная окружения `DATABASE_URL` содержит корректный URL вашей базы данных
2. Запустите скрипт экспорта:

```bash
node scripts/export_db.js
```

3. Скрипт создаст резервную копию в каталоге `scripts/db_backup`
4. Сохраните этот файл локально на вашем компьютере (скачайте его из Replit через интерфейс)

## Настройка проекта в Railway

1. Войдите в аккаунт Railway: https://railway.app/
2. Создайте новый проект:
   - Нажмите "New Project"
   - Выберите "Deploy from GitHub repo"
   - Подключите свой GitHub аккаунт и выберите репозиторий с проектом

3. Railway автоматически определит, что это Node.js приложение и настроит основные параметры

4. Добавьте базу данных PostgreSQL:
   - В созданном проекте нажмите "New"
   - Выберите "Database" -> "PostgreSQL"
   - Railway создаст новую базу данных и настроит переменную окружения `DATABASE_URL`

## Деплой приложения

Railway должен автоматически начать деплой вашего приложения после создания проекта. Следите за процессом в интерфейсе Railway.

## Настройка переменных окружения

Настройте переменные окружения в проекте Railway:

1. Перейдите во вкладку "Variables" вашего сервиса
2. Убедитесь, что `DATABASE_URL` уже настроен (он должен быть добавлен автоматически)
3. Добавьте следующие переменные:
   - `TELEGRAM_BOT_TOKEN`: токен вашего Telegram бота
   - `NODE_ENV`: установите значение `production`
   - `WEB_APP_URL`: URL вашего приложения в Railway (без слэша в конце, формат: `https://your-app-name.railway.app`)

## Импорт базы данных

После успешного деплоя приложения необходимо импортировать данные в новую базу данных:

1. Скопируйте значение `DATABASE_URL` из переменных окружения Railway
2. Создайте локальный файл .env с этой переменной или установите её в командной строке
3. Поместите файл бэкапа в директорию `scripts/db_backup` локального проекта
4. Запустите скрипт импорта:

```bash
node scripts/import_db.js
```

5. Следуйте инструкциям в консоли для выбора файла бэкапа

## Настройка Telegram бота

Обновите настройки вашего Telegram бота, чтобы он указывал на новый URL:

1. Используйте BotFather для обновления домена вашего бота
2. Убедитесь, что ваш бот использует URL из Railway для Web App

## Проверка работоспособности

После завершения всех этапов проверьте работоспособность приложения:

1. Откройте URL вашего приложения в браузере
2. Проверьте работу Telegram бота
3. Убедитесь, что все функции работают корректно

## Дальнейшая разработка

Вы можете продолжать разработку в Replit. Чтобы обновить версию на Railway после внесения изменений:

1. Закоммитьте изменения в Git репозиторий
2. Railway автоматически начнет новый деплой при обнаружении новых коммитов

При необходимости обновления данных на Railway:

1. Экспортируйте актуальные данные из Replit
2. Импортируйте их в базу данных Railway

## Примечания

- Railway предлагает бесплатный тариф с ограничениями по времени использования и ресурсам. Ознакомьтесь с текущими ограничениями на их сайте.
- Для продакшн-окружения рекомендуется настроить автоматическое резервное копирование базы данных.
- Railway поддерживает непрерывную интеграцию (CI/CD), которая автоматически обновляет приложение при коммитах в репозиторий.